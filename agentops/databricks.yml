# The name of the bundle. run `databricks bundle schema` to see the full bundle settings schema.
bundle:
  name: agentops

variables:
  # Data tables
  raw_data_table:
    description: "Table in Unity Catalog to store raw data."
    default: raw_documentation
  preprocessed_data_table: 
      description: "Table in Unity Catalog to store preprocessed data."
      default: databricks_documentation
  eval_table:
    description: "Table in Unity Catalog to store evaluation data."
    default: "databricks_documentation_eval"

  # Vector search infrastructure
  vector_search_endpoint:
    description: "Vector Search endpoint to create."
    default: ai_agent_endpoint
  vector_search_index:
    description: "Vector Search index to populate."
    default: databricks_documentation_vs_index
  
  # MLflow model registration
  experiment:
    description: "Experiment to log run under."
    default: /Users/${workspace.current_user.userName}/agent_function_chatbot
  registered_model:
    description: "Name of agent model to register."
    default: agent_function_chatbot
  model_alias:
    description: "Model alias to use for trained model"
    default: agent_latest

  # Deployment configuration
  agent_serving_endpoint: 
    description: "Name of the agent model servign endpoint (optional). If empty, agents.deploy() will auto-generate. Must NOT be pre-created in bundle"
    default: "" 
  mlflow_experiment_path:
    description: "Non-Git MLflow experiment path for agent tracing. If empty, auto-generated."
    default: ""
  app_name: 
    description: "Name of the Databricks App"
    default: "agent-chatbot"

include:
  # Resources folder contains Agent artifact resources for the Agent project that defines the agent
  # and workflows resources for data preparation -> agent creation & evaluation -> deployment
  - ./resources/data-preparation-resource.yml
  - ./resources/agents-artifacts-resource.yml
  - ./resources/agent-resource.yml
  - ./resources/app-resource.yml  # Databricks App deployed as bundle resource

# Sync app files to workspace for app deployment
sync:
  include:
    - agent_deployment/chat_interface_deployment/app.py
    - agent_deployment/chat_interface_deployment/DatabricksChatbot.py
    - agent_deployment/chat_interface_deployment/utils.py
    - agent_deployment/chat_interface_deployment/app.yaml

# Deployment Target specific values for workspace
targets:
  dev:
    default: true
    workspace:
      # TODO: add dev workspace URL
      host: https://adb-3938831970425198.18.azuredatabricks.net/
    variables: 
      uc_catalog: sdagentops_dev
      schema: agentops_dev

  staging:
    workspace:
      host: https://adb-3527003717004027.7.azuredatabricks.net

    variables: 
      uc_catalog: sdagentops_staging
      schema: agentops_staging

  prod:
    workspace:
      host: https://adb-346253566264244.4.azuredatabricks.net
    variables: 
      uc_catalog: sdagentops_prod
      schema: agentops_prod

  test: 
    workspace:
      host: https://adb-3527003717004027.7.azuredatabricks.net
    
    variables: 
      uc_catalog: sdagentops_test
      schema: agentops_test


